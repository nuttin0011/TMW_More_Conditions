-- ZRO Decoder 9.0.5/9Oh
if not IROUsedSkillControl then IROUsedSkillControl={}end;if not IUSC then IUSC=IROUsedSkillControl end;if not EROTools then EROTools={}end;if not EROTools.IUSCLog then EROTools.IUSCLog={}end;if not EROTools.IUSCLog.UpdateText then EROTools.IUSCLog.UpdateText=function()end end;local GetTime=GetTime;IUSC.NeedAdjust=false;IUSC.GCDAdjust=0;IUSC.GCDAdjustT1=0;IUSC.GCDAdjustT2=0;IUSC.CastAdjust=0;IUSC.CastAdjustT1=0;IUSC.CastAdjustT2=0;IUSC.debugmode=false;IUSC.SkillPressStampTime=0;IUSC.IUSCLog=""IUSC.IUSCLog1stLine=""IUSC.SkillPress=0;IUSC.KeepLogOffGCD=function()if IUSC.KeepLogText then IUSC.KeepLogText(true)end end;IUSC.NextReady=GetTime()IUSC.Stage=1;IUSC.GCDCD=1;IUSC.GCDAtPluse=IUSC.GCDCD;IUSC.GCDCDMinus005=IUSC.GCDCD-0.05;IUSC.GCDCDMinus02=IUSC.GCDCD-0.2;IUSC.PlayerSpec=GetSpecializationInfo(GetSpecialization())IUSC.spec1secGCD={[259]=true,[260]=true,[261]=true,[103]=true,[269]=true}IUSC.NumToSpell={}IUSC.NumToID={}IUSC.IDToSpell={}IUSC.RegCallBackAfterSO={}IUSC.RegCallBackAfterSU={}IUSC.AfterSO=function(a)for b,c in pairs(IUSC.RegCallBackAfterSO)do c(a)end end;IUSC.AfterSU=function(a)for b,c in pairs(IUSC.RegCallBackAfterSU)do c(a)end end;IUSC.LastSU=nil;IUSC.Ping={}local d=IUSC.Ping;function d.aP()d.now=select(4,GetNetStats())/1000;d.nowPlus=math.min(0.8,d.now*2)C_Timer.After(7.8,d.aP)end;d.aP()local function e(f)local g,h=GetSpellCooldown(f)return g+h end;local function i()return select(2,GetSpellCooldown(TMW.GCDSpell))end;function IUSC.LastSkillUse()return IUSC.LastSU end;function IUSC.NotReadyToUseSkill()return IUSC.Stage~=1 end;function IUSC.Haste_Event(j,k,l)if l=="player"and not IUSC.spec1secGCD[IUSC.PlayerSpec]then IUSC.GCDCD=math.max(0.5,1.5*100/(100+UnitSpellHaste("player")))IUSC.GCDCD=math.floor(IUSC.GCDCD*1000)/1000;IUSC.GCDCDMinus005=IUSC.GCDCD-0.05;IUSC.GCDCDMinus02=IUSC.GCDCD-d.nowPlus end end;IUSC.Haste_Event(nil,nil,"player")IUSC.f1=CreateFrame("Frame")IUSC.f1:RegisterEvent("UNIT_SPELL_HASTE")IUSC.f1:SetScript("OnEvent",IUSC.Haste_Event)function IUSC.SpecChanged()local m=GetSpecializationInfo(GetSpecialization())if IUSC.spec1secGCD[m]then IUSC.GCDCD=1 else IUSC.GCDCD=math.max(0.5,1.5*100/(100+UnitSpellHaste("player")))IUSC.GCDCD=math.floor(IUSC.GCDCD*1000)/1000 end;IUSC.GCDCDMinus005=IUSC.GCDCD-0.05;IUSC.GCDCDMinus02=IUSC.GCDCD-d.nowPlus;IUSC.PlayerSpec=m end;C_Timer.After(5,IUSC.SpecChanged)IUSC.f2=CreateFrame("Frame")IUSC.f2:RegisterEvent("PLAYER_SPECIALIZATION_CHANGED")IUSC.f2:SetScript("OnEvent",IUSC.SpecChanged)function IUSC.Cast_OnEvent(self,k,n,o,p,q)local function r()IUSC.GCDPluseActive=false;IUSC.SpellActive=false;IUSC.GCDTickHandle:Cancel()IUSC.forceReady()end;if n~="player"then return end;if k=="UNIT_SPELLCAST_SENT"and q==IUSC.SkillPress then if IUSC.debugmode then IUSC.printdebug("^SENT:"..string.format("%.2f",GetTime()-IUSC.SkillPressStampTime))end;IUSC.SENTStampTime=GetTime()local s=i()if math.abs(IUSC.GCDAtPluse-s)>0.08 then IUSC.ReCreateGCDPluse(s-0.05+IUSC.GCDAdjust,s)end elseif k=="UNIT_SPELLCAST_START"and p==IUSC.SkillPress then if IUSC.debugmode then IUSC.printdebug("^START")end;if not IUSC.GCDPluseActive then IUSC.GCDPluseNextTick=GetTime()+IUSC.GCDCDMinus005-d.nowPlus end;IUSC.Stage=2;IUSC.StopPluse(true)IUSC.CreateCastPluse()elseif k=="UNIT_SPELLCAST_SUCCEEDED"and p==IUSC.SkillPress then local t=GetTime()if IUSC.SpellActive==false and t-IUSC.SENTStampTime<0.1 then if t-IUSC.SkillPressStampTime>d.nowPlus then if IUSC.debugmode then IUSC.printdebug("^Instance Cast Skill Adjust GCD")end;IUSC.StopPluse()IUSC.CreateGCDPluse(IUSC.GCDAtPluse-0.2)end end elseif k=="UNIT_SPELLCAST_STOP"and p==IUSC.SkillPress then if IUSC.debugmode then IUSC.printdebug("^STOP")end elseif k=="UNIT_SPELLCAST_FAILED"and p==IUSC.SkillPress then if IUSC.debugmode then IUSC.printdebug("^FAILED")end;r()elseif k=="UNIT_SPELLCAST_INTERRUPTED"and p==IUSC.SkillPress then if IUSC.SpellActive==true then if IUSC.debugmode then IUSC.printdebug("^INTERRUPTED")end;r()end elseif k=="UNIT_SPELLCAST_FAILED_QUIET"and p==IUSC.SkillPress then if IUSC.debugmode then IUSC.printdebug("^FAILED_QUIET")end;r()end end;IUSC.f3=CreateFrame("Frame")IUSC.f3:RegisterEvent("UNIT_SPELLCAST_START")IUSC.f3:RegisterEvent("UNIT_SPELLCAST_FAILED")IUSC.f3:RegisterEvent("UNIT_SPELLCAST_INTERRUPTED")IUSC.f3:RegisterEvent("UNIT_SPELLCAST_FAILED_QUIET")IUSC.f3:RegisterEvent("UNIT_SPELLCAST_SENT")IUSC.f3:RegisterEvent("UNIT_SPELLCAST_SUCCEEDED")IUSC.f3:SetScript("OnEvent",IUSC.Cast_OnEvent)IUSC.GCDTickHandle=C_Timer.NewTimer(0,function()end)IUSC.CheckSentEventHandle=C_Timer.NewTimer(0,function()end)IUSC.GCDPluseActive=false;IUSC.SpellActive=false;IUSC.GCDPluseTimeStamp=0;IUSC.GCDPluseNextTick=0;IUSC.SENTStampTime=0;IUSC.SkillNameLen=0;function IUSC.printdebug(u)IUSC.IUSCLog1stLine=IUSC.IUSCLog1stLine..u;if string.sub(IUSC.IUSCLog1stLine,string.len(IUSC.IUSCLog1stLine))=="\n"then IUSC.IUSCLog=IUSC.IUSCLog1stLine..IUSC.IUSCLog;IUSC.IUSCLog1stLine=""end;EROTools.IUSCLog.UpdateText()end;function IUSC.forceReady()if IUSC.debugmode then IUSC.printdebug("^READY\n")end;IUSC.Stage=1;IUSC.NextReady=0 end;function IUSC.CreateGCDPluse(v)if IUSC.debugmode then IUSC.printdebug("^GCD pluse")end;IUSC.GCDTickHandle:Cancel()IUSC.GCDPluseActive=true;IUSC.GCDAtPluse=IUSC.GCDCD;IUSC.GCDPluseTimeStamp=GetTime()IUSC.GCDPluseNextTick=IUSC.GCDPluseTimeStamp+v;IUSC.NextReady=IUSC.GCDPluseNextTick;IUSC.GCDTickHandle=C_Timer.NewTimer(v,function()if IUSC.debugmode then IUSC.printdebug("^GCD Pluse end")end;IUSC.GCDPluseActive=false;IUSC.forceReady()end)end;function IUSC.StopPluse(w)if IUSC.debugmode and not w then IUSC.printdebug("^stop pluse")end;IUSC.GCDTickHandle:Cancel()IUSC.GCDPluseActive=false;IUSC.SpellActive=false end;function IUSC.ReCreateGCDPluse(v,s)if not IUSC.GCDPluseActive then return end;if IUSC.debugmode then IUSC.printdebug("^ReCreateGCD pluse")end;local x=GetTime()if IUSC.GCDPluseTimeStamp+v-x<0.1 then v=x+0.1-IUSC.GCDPluseTimeStamp end;IUSC.GCDTickHandle:Cancel()IUSC.GCDAtPluse=s;IUSC.GCDPluseNextTick=IUSC.GCDPluseTimeStamp+v;IUSC.NextReady=IUSC.GCDPluseNextTick;IUSC.GCDTickHandle=C_Timer.NewTimer(IUSC.NextReady-x,function()if IUSC.debugmode then IUSC.printdebug("^GCD Pluse end")end;IUSC.GCDPluseActive=false;IUSC.forceReady()end)end;function IUSC.CreateCastPluse()if IUSC.debugmode then IUSC.printdebug("^Cast pluse")end;IUSC.GCDTickHandle:Cancel()IUSC.SpellActive=true;IUSC.SpellTimeStamp=GetTime()local y,b,b,b,z=UnitCastingInfo("player")z=z/1000-d.nowPlus;if IUSC.debugmode then IUSC.printdebug("^castting..")end;z=z-IUSC.SpellTimeStamp;if z<0 then z=0.1 end;IUSC.NextReady=IUSC.SpellTimeStamp+z;IUSC.GCDTickHandle=C_Timer.NewTimer(z,function()if IUSC.debugmode then IUSC.printdebug("^cast pluse end")end;IUSC.SpellActive=false;IUSC.forceReady()end)end;function IUSC.SU(A,B)if IUSC.Stage~=1 then if IUSC.debugmode then print(GetTime())print(A,"!!!! use Skill before ready ^^^ IUSC.Stage = "..IUSC.Stage)end;return end;local C=IsShiftKeyDown()and 4 or 0;local D=IsControlKeyDown()and 1 or 0;local E=IsAltKeyDown()and 2 or 0;D=E+C+D;C=bit.lshift(tonumber(A,16),8)D=bit.bor(D,C)if not IsCurrentSpell(IUSC.NumToID[D])then local F=select(7,GetSpellInfo(IUSC.NumToSpell[D]))if F and IsCurrentSpell(F)then IUSC.NumToID[D]=F else if IUSC.debugmode then IUSC.printdebug("skill "..(IUSC.NumToSpell[D]or"SPELL NOT FOUND").."NOT Q")end;IUSC.forceReady()return end end;if IUSC.KeepLogText then IUSC.KeepLogText()end;IUSC.Stage=2;IUSC.SkillPress=IUSC.NumToID[D]or 0;local G=GetTime()if IUSC.debugmode then local f=IUSC.NumToSpell[D]or"none"local H=string.len(f)local I=G-IUSC.SkillPressStampTime-IUSC.GCDCD;if I>0.01 then IUSC.GCDAdjust=IUSC.GCDAdjust-0.01 end;if I<0 then IUSC.GCDAdjust=IUSC.GCDAdjust+0.01 end;local J;local K=string.format("%.2f",I).."s"I=I/IUSC.GCDCD;if I>5 then J="+>5GCD "..K else J="+"..string.format("%.2f",I).."GCD "..K end;IUSC.SkillNameLen=math.max(IUSC.SkillNameLen,H)f=f..string.rep(" ",IUSC.SkillNameLen-H)IUSC.printdebug(">>"..J.." "..G.." USE: "..f)end;IUSC.SkillPressStampTime=G;IUSC.LastSU=IUSC.NumToSpell[D]IUSC.CreateGCDPluse(B or IUSC.GCDCDMinus005+IUSC.GCDAdjust)IUSC.AfterSU(IUSC.NumToID[D])end;function IUSC.SO(A)local C=IsShiftKeyDown()and 4 or 0;local D=IsControlKeyDown()and 1 or 0;local E=IsAltKeyDown()and 2 or 0;D=E+C+D;C=bit.lshift(tonumber(A,16),8)D=bit.bor(D,C)if IUSC.KeepLogText then IUSC.KeepLogText(true)end;IUSC.AfterSO(IUSC.NumToID[D])end;local L={["00"]=0x00,["21"]=0x01,["22"]=0x02,["23"]=0x03,["24"]=0x04,["25"]=0x05,["26"]=0x06,["27"]=0x07,["28"]=0x08,["29"]=0x09,["2a"]=0x0a,["2b"]=0x0b,["2c"]=0x0c,["30"]=0x0d,["31"]=0x0e,["32"]=0x0f,["33"]=0x10,["34"]=0x11,["35"]=0x12,["36"]=0x13,["37"]=0x14,["38"]=0x15,["39"]=0x16,["3a"]=0x17,["3b"]=0x18,["3c"]=0x19,["3d"]=0x1a,["3e"]=0x1b,["55"]=0x1c}local M={["00"]=0,["01"]=bit.lshift(0x01,5),["02"]=bit.lshift(0x02,5),["03"]=bit.lshift(0x03,5),["04"]=bit.lshift(0x04,5),["05"]=bit.lshift(0x05,5),["06"]=bit.lshift(0x06,5),["07"]=bit.lshift(0x07,5)}function enSubMiniIROCode(N)if not N then return"00"end;local O=M[string.sub(N,3,4)]if not O then return"00"end;local P=L[string.sub(N,5,6)]if not P then return"00"end;return string.format("%02x",P+O)end;function getMetaIconColor(Q)if not Q then return"ff000000"end;local R=Q.__currentIcon;local S=R and R.__currentIcon or nil;while S do R=S;S=R.__currentIcon end;local T=R and R.States[1].Color or"ff000000"return T end;function enMiniIROcode(U,V,W)local X=enSubMiniIROCode(U)local Y=enSubMiniIROCode(V)local Z=enSubMiniIROCode(W)return"ff"..Z..Y..X end;IUSC.ClassType={[71]={'B','Pummel','Pummel','Melee','DPS','InstanceCast'},[72]={'B','Pummel','Pummel','Melee','DPS','InstanceCast'},[73]={'A','Pummel','Pummel','Melee','Tank','InstanceCast'},[265]={'D','Spell Lock','Corruption','Range','DPS','Caster'},[266]={'D','Axe Toss','Corruption','Range','DPS','Caster'},[267]={'D','Spell Lock','Corruption','Range','DPS','Caster'},[262]={'C','Wind Shear','Lightning Bolt','Range','DPS','Caster'},[263]={'B','Wind Shear','primal strike','Melee','DPS','InstanceCast'},[264]={'D','Wind Shear','Lightning Bolt','Range','Healer','Caster'},[259]={'B','Kick','Kick','Melee','DPS','InstanceCast'},[260]={'B','Kick','Kick','Melee','DPS','InstanceCast'},[261]={'B','Kick','Kick','Melee','DPS','InstanceCast'},[256]={'N','','Smite','Range','Healer','Caster'},[257]={'N','','Smite','Range','Healer','Caster'},[258]={'D','Silence','Smite','Range','DPS','Caster'},[65]={'N','','Crusader Strike','Range','Healer','Caster'},[66]={'A','Rebuke','Crusader Strike','Melee','Tank','InstanceCast'},[70]={'B','Rebuke','Crusader Strike','Melee','DPS','InstanceCast'},[268]={'A','Spear Hand Strike','Tiger Palm','Melee','Tank','InstanceCast'},[270]={'N','','Tiger Palm','Range','Healer','Caster'},[269]={'B','Spear Hand Strike','Tiger Palm','Melee','DPS','InstanceCast'},[62]={'C','Counterspell','Fire Blast','Range','DPS','Caster'},[63]={'C','Counterspell','Fire Blast','Range','DPS','Caster'},[64]={'C','Counterspell','Fire Blast','Range','DPS','Caster'},[253]={'C','Counter Shot','Arcane Shot','Range','DPS','InstanceCast'},[254]={'C','Counter Shot','Arcane Shot','Range','DPS','InstanceCast'},[255]={'C','Muzzle','Raptor Strike','Melee','DPS','InstanceCast'},[102]={'C','Solar Beam','Moonfire','Range','DPS','Caster'},[103]={'B','Skull Bash','Rake','Melee','DPS','InstanceCast'},[104]={'A','Skull Bash','Mangle','Melee','Tank','Caster'},[105]={'N','','Moonfire','Range','Healer','Caster'},[577]={'B','Disrupt','Chaos Strike','Melee','DPS','InstanceCast'},[581]={'A','Disrupt','Chaos Strike','Melee','Tank','InstanceCast'},[250]={'A','Mind Freeze','Death Strike','Melee','Tank','InstanceCast'},[251]={'B','Mind Freeze','Death Strike','Melee','DPS','InstanceCast'},[252]={'B','Mind Freeze','Death Strike','Melee','DPS','InstanceCast'}}