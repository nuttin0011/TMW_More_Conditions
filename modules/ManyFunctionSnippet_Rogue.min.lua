-- Many Function Rogue 9.0.5/2
if not IROVar then IROVar={}end;if not IROVar.Rogue then IROVar.Rogue={}end;IROVar.Rogue.RTBBuffName={["Broadside"]=true,["True Bearing"]=true,["Ruthless Precision"]=true,["Skull and Crossbones"]=true,["Buried Treasure"]=true,["Grand Melee"]=true}IROVar.Rogue.RTBBuff={}for a,b in pairs(IROVar.Rogue.RTBBuffName)do IROVar.Rogue.RTBBuff[a]=0 end;IROVar.Rogue.playerGUID=UnitGUID("player")IROVar.Rogue.LastTimeUseRtB=0;IROVar.Rogue.TimeCheckRtB=0;function IROVar.Rogue.UpdateRTBBuff()IROVar.Rogue.RTBBuff.OldCount=-1;local c=GetTime()local d=math.huge;for a,b in pairs(IROVar.Rogue.RTBBuffName)do IROVar.Rogue.RTBBuff[a]=0 end;for e=1,40 do local f,b,b,b,b,g=UnitBuff("player",e,"PLAYER")if not f then break else g=g-1;if IROVar.Rogue.RTBBuffName[f]and g>c then IROVar.Rogue.RTBBuff[f]=g;if g<d then d=g end end end end;return d+0.3 end;IROVar.Rogue.RTBBuff.OldCount=-1;function IROVar.Rogue.RTBBuff.count()local c=GetTime()if c>IROVar.Rogue.TimeCheckRtB then IROVar.Rogue.TimeCheckRtB=IROVar.Rogue.UpdateRTBBuff()IROVar.Rogue.RTBBuff.OldCount=-1 end;if IROVar.Rogue.RTBBuff.OldCount>=0 then return IROVar.Rogue.RTBBuff.OldCount end;local h=0;for a,b in pairs(IROVar.Rogue.RTBBuffName)do if IROVar.Rogue.RTBBuff[a]>c then h=h+1 end end;IROVar.Rogue.RTBBuff.OldCount=h;return h end;function IROVar.Rogue.CombatEvent()local b,i,b,j,b,b,b,b,b,b,b,b,k=CombatLogGetCurrentEventInfo()if j~=IROVar.Rogue.playerGUID then return end;local c=GetTime()if i=="SPELL_CAST_SUCCESS"and k=="Roll the Bones"then IROVar.Rogue.LastTimeUseRtB=c;IROVar.Rogue.TimeCheckRtB=c+0.2 end;if i=="SPELL_AURA_APPLIED"then if IROVar.Rogue.RTBBuffName[k]then IROVar.Rogue.TimeCheckRtB=c+0.2 end end;if i=="SPELL_AURA_REMOVED"then if IROVar.Rogue.RTBBuffName[k]then IROVar.Rogue.TimeCheckRtB=c+0.2 end end end;IROVar.Rogue.cframe=CreateFrame("Frame")IROVar.Rogue.cframe:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED")IROVar.Rogue.cframe:SetScript("OnEvent",IROVar.Rogue.CombatEvent)function IROVar.Rogue.NeedRTB()if TMW.CNDT.Env.CooldownDuration("Roll the Bones")>0 then return false end;IROVar.Rogue.UpdateRTBBuff()local c=GetTime()if c-IROVar.Rogue.LastTimeUseRtB>30 then return true end;if c>IROVar.Rogue.TimeCheckRtB then IROVar.Rogue.TimeCheckRtB=IROVar.Rogue.UpdateRTBBuff()IROVar.Rogue.RTBBuff.OldCount=-1 end;local l=IROVar.Rogue.RTBBuff.count()if l==0 then return true end;if l>=3 then return false end;if l==2 then return IROVar.Rogue.RTBBuff["Grand Melee"]>c and IROVar.Rogue.RTBBuff["Buried Treasure"]>c end;if IROVar.activeConduits["Sleight of Hand"]then return true end;return not(IROVar.Rogue.RTBBuff["Broadside"]>c or IROVar.Rogue.RTBBuff["True Bearing"]>c)end;function IROVar.Rogue.IsEnOverFlowNextGCD(m)m=m or 1;local n=UnitPower("player",3)local o=UnitPowerMax("player",3)local p=GetPowerRegen()return p*m+n>o end;function IROVar.Rogue.ComboSerratedBoneSpikeGen()local q=1;for e=1,30 do local m="nameplate"..e;if UnitExists(m)and UnitCanAttack("player",m)then if TMW.CNDT.Env.AuraDur(m,"serrated bone spike","PLAYER HARMFUL")>0 then q=q+1 end end end;if TMW.CNDT.Env.AuraDur("player","Broadside","PLAYER HELPFUL")>0.5 then q=q+q end;return q end;function IROVar.Rogue.NeedSerratedBoneSpike()local r=UnitPowerMax("player",4)-UnitPower("player",4)if r==0 then return false end;local s=TMW.CNDT.Env.AuraDur("target","serrated bone spike","PLAYER HARMFUL")>0;local t=IROVar.Rogue.ComboSerratedBoneSpikeGen()local n=UnitPower("player",3)local u,v,w,x=GetSpellCharges("Serrated Bone Spike")local y=u==v or u==v-1 and GetTime()>w+x-5;if s then if t<=r and n<60 then return true end;if y then if t<=r then return true end;if t>=3 and r>=3 then return true end end else if t<=r then return true end;if y and t>=3 and r>=3 then return true end end;return false end