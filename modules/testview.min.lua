if not IROUsedSkillControl then IROUsedSkillControl={}end;IROUsedSkillControl.IdleTimeAfterUseSkill=0.2;IROUsedSkillControl.PlayerSpec=GetSpecializationInfo(GetSpecialization())IROUsedSkillControl.AdjustIdleTimeAfterUseSkill=function()IROUsedSkillControl.PlayerSpec=GetSpecializationInfo(GetSpecialization())local a=IROUsedSkillControl.ClassType[IROUsedSkillControl.PlayerSpec][6]if a=='Caster'then IROUsedSkillControl.IdleTimeAfterUseSkill=0.4 else IROUsedSkillControl.IdleTimeAfterUseSkill=0.4 end end;C_Timer.After(5,IROUsedSkillControl.AdjustIdleTimeAfterUseSkill)IROUsedSkillControl.f2=CreateFrame("Frame")IROUsedSkillControl.f2:RegisterEvent("PLAYER_SPECIALIZATION_CHANGED")IROUsedSkillControl.f2:SetScript("OnEvent",IROUsedSkillControl.AdjustIdleTimeAfterUseSkill)IROUsedSkillControl.pingadjust=0.25;IROUsedSkillControl.ClassType={[71]={'B','Pummel','Pummel','Melee','DPS','InstanceCast'},[72]={'B','Pummel','Pummel','Melee','DPS','InstanceCast'},[73]={'A','Pummel','Pummel','Melee','Tank','InstanceCast'},[265]={'D','Command Demon','Corruption','Range','DPS','Caster'},[266]={'D','Command Demon','Corruption','Range','DPS','Caster'},[267]={'D','Command Demon','Corruption','Range','DPS','Caster'},[262]={'C','Wind Shear','Lightning Bolt','Range','DPS','Caster'},[263]={'B','Wind Shear','primal strike','Melee','DPS','InstanceCast'},[264]={'D','Wind Shear','Lightning Bolt','Range','Healer','Caster'},[259]={'B','Kick','Kick','Melee','DPS','InstanceCast'},[260]={'B','Kick','Kick','Melee','DPS','InstanceCast'},[261]={'B','Kick','Kick','Melee','DPS','InstanceCast'},[256]={'N','','Smite','Range','Healer','Caster'},[257]={'N','','Smite','Range','Healer','Caster'},[258]={'D','Silence','Smite','Range','DPS','Caster'},[65]={'N','','Crusader Strike','Range','Healer','Caster'},[66]={'A','Rebuke','Crusader Strike','Melee','Tank','InstanceCast'},[70]={'B','Rebuke','Crusader Strike','Melee','DPS','InstanceCast'},[268]={'A','Spear Hand Strike','Tiger Palm','Melee','Tank','InstanceCast'},[270]={'N','','Tiger Palm','Range','Healer','Caster'},[269]={'B','Spear Hand Strike','Tiger Palm','Melee','DPS','InstanceCast'},[62]={'C','Counterspell','Fire Blast','Range','DPS','Caster'},[63]={'C','Counterspell','Fire Blast','Range','DPS','Caster'},[64]={'C','Counterspell','Fire Blast','Range','DPS','Caster'},[253]={'C','Counter Shot','Arcane Shot','Range','DPS','InstanceCast'},[254]={'C','Counter Shot','Arcane Shot','Range','DPS','InstanceCast'},[255]={'C','Muzzle','Raptor Strike','Melee','DPS','InstanceCast'},[102]={'C','Solar Beam','Moonfire','Range','DPS','Caster'},[103]={'B','Skull Bash','Rake','Melee','DPS','InstanceCast'},[104]={'A','Skull Bash','Mangle','Melee','Tank','Caster'},[105]={'N','','Moonfire','Range','Healer','Caster'},[577]={'B','Disrupt','Chaos Strike','Melee','DPS','InstanceCast'},[581]={'A','Disrupt','Chaos Strike','Melee','Tank','InstanceCast'},[250]={'A','Mind Freeze','Death Strike','Melee','Tank','InstanceCast'},[251]={'B','Mind Freeze','Death Strike','Melee','DPS','InstanceCast'},[252]={'B','Mind Freeze','Death Strike','Melee','DPS','InstanceCast'}}local b=TMW.GCDSpell;local GetSpellCooldown=GetSpellCooldown;local UnitCastingInfo=UnitCastingInfo;local UnitChannelInfo=UnitChannelInfo;local GetTime=GetTime;local c={["00"]=0x00,["21"]=0x01,["22"]=0x02,["23"]=0x03,["24"]=0x04,["25"]=0x05,["26"]=0x06,["27"]=0x07,["28"]=0x08,["29"]=0x09,["2a"]=0x0a,["2b"]=0x0b,["2c"]=0x0c,["30"]=0x0d,["31"]=0x0e,["32"]=0x0f,["33"]=0x10,["34"]=0x11,["35"]=0x12,["36"]=0x13,["37"]=0x14,["38"]=0x15,["39"]=0x16,["3a"]=0x17,["3b"]=0x18,["3c"]=0x19,["3d"]=0x1a,["3e"]=0x1b,["55"]=0x1c}local d={["00"]=0,["01"]=bit.lshift(0x01,5),["02"]=bit.lshift(0x02,5),["03"]=bit.lshift(0x03,5),["04"]=bit.lshift(0x04,5),["05"]=bit.lshift(0x05,5),["06"]=bit.lshift(0x06,5),["07"]=bit.lshift(0x07,5)}function enSubMiniIROCode(e)if not e then return"00"end;local f=d[string.sub(e,3,4)]if not f then return"00"end;local g=c[string.sub(e,5,6)]if not g then return"00"end;return string.format("%02x",g+f)end;function getMetaIconColor(h)local i=h.__currentIcon;local j=i and i.__currentIcon or nil;while j do i=j;j=i.__currentIcon end;local k=i and i.States[1].Color or"ff000000"return k end;function enMiniIROcode(l,m,n)local o=enSubMiniIROCode(l)local p=enSubMiniIROCode(m)local q=enSubMiniIROCode(n)return"ff"..q..p..o end;local r={}r.now=0;r.adjustTiming=5.14;r.adjustWorldPing=function()r.now=select(4,GetNetStats())/1000;C_Timer.After(r.adjustTiming,r.adjustWorldPing)end;r.adjustWorldPing()local s=0.2;function NextTimeCheckLockUseSkill(t)local u,v=GetSpellCooldown(b)local w,x,x,x,y=UnitCastingInfo("player")if not w then w,x,x,x,y=UnitChannelInfo("player")end;local z=GetTime()local A,B;t=t or s;if w then A=y/1000;B=A-(r.now+t)if z<B then return B,false else return A+t,true end else if not u then return z+0.3,true else A=u+v;B=A-(r.now+t)if z<B then return B,false else return A+t,true end end end end;IROUsedSkillControl.Stage=1;IROUsedSkillControl.SkillHandle={}IROUsedSkillControl.PlayerGUID=UnitGUID("player")IROUsedSkillControl.NextForceReady=0;IROUsedSkillControl.OldTimeNumDotPress=0;function IROUsedSkillControl.OnEvent()local x,C,x,D=CombatLogGetCurrentEventInfo()if D==IROUsedSkillControl.PlayerGUID and C=="SPELL_CAST_FAILED"then IROUsedSkillControl.forceReady()end end;IROUsedSkillControl.f=CreateFrame("Frame")IROUsedSkillControl.f:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED")IROUsedSkillControl.f:SetScript("OnEvent",IROUsedSkillControl.OnEvent)IROUsedSkillControl.KeepLogOffGCD=function()if IROUsedSkillControl.KeepLogText then IROUsedSkillControl.KeepLogText(true)end end;IROUsedSkillControl.NumDotPress=function()if IROUsedSkillControl.KeepLogText then IROUsedSkillControl.KeepLogText()end;IROUsedSkillControl.Stage=2;IROUsedSkillControl.Stage2to4()end;IROUsedSkillControl.NotReadyToUseSkill=function()return IROUsedSkillControl.Stage~=1 end;IROUsedSkillControl.forceReady=function()local z=GetTime()if IROUsedSkillControl.NextForceReady>z then return end;IROUsedSkillControl.NextForceReady=z+0.19;for x,E in pairs(IROUsedSkillControl.SkillHandle)do E:Cancel()end;IROUsedSkillControl.SkillHandle={}IROUsedSkillControl.Stage=1 end;IROUsedSkillControl.Stage2to4=function()IROUsedSkillControl.Stage=3;table.insert(IROUsedSkillControl.SkillHandle,C_Timer.NewTimer(IROUsedSkillControl.IdleTimeAfterUseSkill,IROUsedSkillControl.CheckStageto4))end;IROUsedSkillControl.CheckStageto4=function()if IROUsedSkillControl.Stage~=1 then IROUsedSkillControl.Stage=4;IROUsedSkillControl.Stage4to1()end end;IROUsedSkillControl.Stage4to1=function()local z;local F,G=NextTimeCheckLockUseSkill(IROUsedSkillControl.pingadjust)if G then IROUsedSkillControl.forceReady()else IROUsedSkillControl.Stage=5;z=GetTime()local H=F-z;if H>0.2 then H=0.2 end;if H<0 then H=0 end;table.insert(IROUsedSkillControl.SkillHandle,C_Timer.NewTimer(H,IROUsedSkillControl.CheckStageto4))end end