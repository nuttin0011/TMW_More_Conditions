-- Many Function Version 9.0.5/70
-- Set Priority to 1
if not IROVar then IROVar={}end;IROVar.Icon={}function IROVar.IsIconShow(a)return a and a.attributes.shown and not a:Update()and a.attributes.realAlpha>0 end;local GetTime=GetTime;local GetSpellCooldown=GetSpellCooldown;IROVar.playerGUID=UnitGUID("player")IROVar.DebugMode=false;IROVar.InterruptSpell=nil;IROVar.SkillCheckDPSRange=nil;IROVar.InstanceName=GetInstanceInfo()IROVar.activeConduits={}IROVar.EditKeyMacroForAutoTarget=50;IROVar.PLAYER_TARGET_CHANGED_Time=GetTime()IROVar.CCDebuff={}for b,c in ipairs(TMW.BE.debuffs.CrowdControl)do IROVar.CCDebuff[c]=true end;function IROVar.IsUnitCCed(d)if not UnitExists(d)then return false end;local e=false;for f=1,40 do local g,_,_,_,_,_,_,_,_,h=UnitAura(d,f,"HARMFUL")if g then if IROVar.CCDebuff[h]or IROVar.CCDebuff[g]then e=true;break end else break end end;return e end;function IROVar.CounterSetUpdate(i)for b,c in pairs(i)do TMW_ST:UpdateCounter(b,c)end end;function IROVar.CalculateHaste()IROVar.Haste=UnitSpellHaste("player")IROVar.HasteFactor=100/(100+IROVar.Haste)IROVar.CastTime2sec=2*IROVar.HasteFactor;IROVar.CastTime1_5sec=1.5*IROVar.HasteFactor;IROVar.CastTime6sec=6*IROVar.HasteFactor;IROVar.CastTime0_5sec=0.5*IROVar.HasteFactor end;IROVar.CalculateHaste()C_Timer.After(2,IROVar.CalculateHaste)if not IROSpecID then IROSpecID=GetSpecializationInfo(GetSpecialization())end;IROInterruptTier={}for b,c in pairs(IROUsedSkillControl.ClassType)do IROInterruptTier[b]=c end;IROVar.fhaste=CreateFrame("Frame")IROVar.fhaste:RegisterEvent("UNIT_SPELL_HASTE")IROVar.fhaste:SetScript("OnEvent",function(self,j,k)if j=="UNIT_SPELL_HASTE"and k=="player"then IROVar.CalculateHaste()end end)function IROVar.Debug()IROVar.DebugMode=not IROVar.DebugMode;print("IROVar.DebugMode : "..(IROVar.DebugMode and"On"or"Off"))end;function IROVar:fspecOnEvent(j)if IROVar.DebugMode then print("Event : "..(j~=nil and j or"nil"))end;IROVar.UpdateVar()C_Timer.After(5,IROVar.UpdateVar)end;IROVar.fspec=CreateFrame("Frame")IROVar.fspec:RegisterEvent("PLAYER_SPECIALIZATION_CHANGED")IROVar.fspec:RegisterEvent("ZONE_CHANGED_NEW_AREA")IROVar.fspec:SetScript("OnEvent",IROVar.fspecOnEvent)function IROVar.UpdateVar()IROVar.InstanceName=GetInstanceInfo()local l=GetSpecializationInfo(GetSpecialization())if IROVar.DebugMode then if IROSpecID~=l and l~=nil then print("old Spec :"..(IROSpecID~=nil and IROSpecID or"nil"))print("new Spec :"..(l~=nil and l or"nil"))end end;IROSpecID=l or IROSpecID;if IROInterruptTier[IROSpecID]then IROVar.InterruptSpell=IROInterruptTier[IROSpecID][2]IROVar.SkillCheckDPSRange=IROInterruptTier[IROSpecID][3]else IROVar.InterruptSpell=nil;IROVar.SkillCheckDPSRange=nil end end;IROVar.UpdateVar()C_Timer.After(5,IROVar.UpdateVar)IROVar.CheckDPSRange=function(m)if IROVar.SkillCheckDPSRange==nil then return true end;m=m or"target"return IsSpellInRange(IROVar.SkillCheckDPSRange,m)==1 end;IROVar.ERO_Old_Val={Timer=0,Old_Val={},Check=function(n,o)o=o or""return IROVar.ERO_Old_Val.Timer==IROVar.TickCount005 and IROVar.ERO_Old_Val.Old_Val[n]and IROVar.ERO_Old_Val.Old_Val[n][o]and IROVar.ERO_Old_Val.Old_Val[n][o]or nil end,Update=function(n,o,p)o=o or""local q=IROVar.TickCount005;if IROVar.ERO_Old_Val.Timer<q then IROVar.ERO_Old_Val.Timer=q;IROVar.ERO_Old_Val.Old_Val={}end;if not IROVar.ERO_Old_Val.Old_Val[n]then IROVar.ERO_Old_Val.Old_Val[n]={}end;IROVar.ERO_Old_Val.Old_Val[n][o]=p end}local r={[2]=37727,[3]=42732,[4]=129055,[5]=8149,[7]=61323,[8]=34368,[10]=32321,[15]=33069,[20]=10645,[25]=24268,[30]=835,[35]=24269,[38]=140786,[40]=28767,[45]=23836,[50]=116139,[55]=74637,[60]=32825,[70]=41265,[80]=35278,[90]=133925,[100]=33119,[150]=46954,[200]=75208}local s={}for b,c in pairs(r)do s[c]="item:"..b end;local t={}for f=1,200 do if r[f]then table.insert(t,f)end end;IROVar.ItemNameToCheck8="item:34368"function IROVar.Range(d)for f=1,#t do if IsItemInRange(s[t[f]],d)then return t[f-1]or 0 end end;return 300 end;function IROEnemyCountInRange(u)u=u or 8;local v=IROVar.ERO_Old_Val.Check("IROEnemyCountInRange",u)if v then return v end;if u<2 then u=2 end;while r[u]==nil do u=u-1 end;local w=s[u]local x;local y=0;for f=1,30 do x='nameplate'..f;if UnitExists(x)and UnitCanAttack("player",x)then if IsItemInRange(w,x)and(UnitAffectingCombat(x)or u<=8 or IsItemInRange(IROVar.ItemNameToCheck8,x))then y=y+1 end end;if y>=8 then break end end;IROVar.ERO_Old_Val.Update("IROEnemyCountInRange",u,y)return y end;function PercentCastbar2(z,A,d,B,C)z=z or 0.5;if A==nil then A=true end;C=C or 2000;B=B or 200;d=d or"target"local _,_,_,D,E,_,_,F=UnitCastingInfo(d)local G=false;local H;local I;local J;if D~=nil and not(F and A)then H=E-D;I=GetTime()*1000-D;if H-I>=B and H-I<=C then J=I/H;G=J>=z end;return G end;local _,_,_,K,L,_,M=UnitChannelInfo(d)if K~=nil and not(M and A)then H=L-K;I=GetTime()*1000-K;if I>=B and I<=H-B then G=true end end;return G end;function GCDActiveLessThan(N)N=N or 0.2;local O,P=GetSpellCooldown(TMW.GCDSpell)return O+P-GetTime()<N end;function SumPartyHP()local Q=IROVar.ERO_Old_Val.Check("SumPartyHP","")if Q then return Q end;local R=0;if IsInRaid()then local S=GetNumGroupMembers()if S==0 then S=1 end;for f=1,S do R=R+UnitHealth("raid"..f)end elseif IsInGroup()then R=UnitHealth("player")local S=GetNumGroupMembers()for f=1,S-1 do R=R+UnitHealth("party"..f)end else R=UnitHealth("player")end;IROVar.ERO_Old_Val.Update("SumPartyHP","",R)return R end;IROVar.ignoreName={["Spiteful Shade"]=true,["Slithering Ooze"]=true}function SumHPMobinCombat()local Q=IROVar.ERO_Old_Val.Check("SumHPMobinCombat","")if Q then return Q end;local T=0;local x;for U=1,30 do x='nameplate'..U;if UnitExists(x)and not IROVar.ignoreName[UnitName(x)]and UnitCanAttack("player",x)and(UnitAffectingCombat(x)or IsItemInRange(IROVar.ItemNameToCheck8,x))then T=T+UnitHealth(x)end end;IROVar.ERO_Old_Val.Update("SumHPMobinCombat","",T)return T end;function SumHPMobin8yd()local T=0;local x;for U=1,30 do x='nameplate'..U;if UnitExists(x)and CheckInteractDistance(x,2)and UnitCanAttack("player",x)then T=T+UnitHealth(x)end end;return T end;function IROTargetVVHP(V,d)d=d or"target"V=V or 2;local W=SumPartyHP()local X=UnitHealth(d)return V*W<X end;IROVar.IROEnemyGroupVVHPOldVal={}IROVar.IROEnemyGroupVVHPRun=false;function IROEnemyGroupVVHP(V)IROVar.IROEnemyGroupVVHPRun=true;V=V or 3;if IROVar.IROEnemyGroupVVHPOldVal[V]then IROVar.IROEnemyGroupVVHPRun=false;return IROVar.IROEnemyGroupVVHPOldVal[V]end;local W=SumPartyHP()local Y=SumHPMobinCombat()local Z=V*W<Y;IROVar.IROEnemyGroupVVHPOldVal[V]=Z;IROVar.IROEnemyGroupVVHPRun=false;return Z end;C_Timer.NewTicker(0.5,function()if not IROVar.IROEnemyGroupVVHPRun then IROVar.IROEnemyGroupVVHPOldVal={}end end)local a0={[259]=true,[260]=true,[261]=true,[269]=true,[103]=true}IROVar.GCDCDTimeOldHaste=0;IROVar.GCDCDTimeOldGCD=0;function GCDCDTime()local v=IROVar.ERO_Old_Val.Check("GCDCDTime","")if v then return v end;local a1=TMW.GCD;if a1==0 then if not IROSpecID then IROSpecID=GetSpecializationInfo(GetSpecialization())end;if a0[IROSpecID]then a1=1 else if IROVar.GCDCDTimeOldHaste~=IROVar.Haste then a1=1.5*100/(100+IROVar.Haste)IROVar.GCDCDTimeOldHaste=IROVar.Haste;IROVar.GCDCDTimeOldGCD=a1 else a1=IROVar.GCDCDTimeOldGCD end end end;IROVar.ERO_Old_Val.Update("GCDCDTime","",a1)return a1 end;IROVar.temp_allDeBuffByMe={[1]=0,[2]={}}function IROVar.allDeBuffByMe(d)local a2={}local a3=UnitGUID(d)if not a3 then return a2 end;local a4=GetTime()if IROVar.temp_allDeBuffByMe[1]==a4 and IROVar.temp_allDeBuffByMe[2][a3]then return IROVar.temp_allDeBuffByMe[2][a3]end;if IROVar.temp_allDeBuffByMe[1]<a4 then IROVar.temp_allDeBuffByMe[1]=a4;IROVar.temp_allDeBuffByMe[2]={}end;local a5,a6;for f=1,400 do a5,_,_,_,_,a6=UnitAura(d,f,"PLAYER|HARMFUL")if a5 then a2[a5]=a6-GetTime()else break end end;IROVar.temp_allDeBuffByMe[2][a3]=a2;return a2 end;IROVar.temp_allBuffByMe={[1]=0,[2]={}}function IROVar.allBuffByMe(d,a7)local a8={}local a3=UnitGUID(d)if not a3 then return a8 end;local a4=GetTime()if IROVar.temp_allBuffByMe[1]==a4 and IROVar.temp_allBuffByMe[2][a3]then return IROVar.temp_allBuffByMe[2][a3]end;if IROVar.temp_allBuffByMe[1]<a4 then IROVar.temp_allBuffByMe[1]=a4;IROVar.temp_allBuffByMe[2]={}end;local a9,a6;if a7 then for f=1,400 do a9,_,_,_,_,a6=UnitAura(d,f,"PLAYER|HELPFUL")if a9 then a8[string.lower(a9)]=a6-GetTime()else break end end else for f=1,400 do a9,_,_,_,_,a6=UnitAura(d,f,"PLAYER|HELPFUL")if a9 then a8[a9]=a6-GetTime()else break end end end;IROVar.temp_allBuffByMe[2][a3]=a8;return a8 end;function IROVar.IconSweepCompair(a,aa,ab)if not a then return true end;if ab<=0 and a.Modules.IconModule_CooldownSweep.start==0 then return true end;local ac=a.Modules.IconModule_CooldownSweep.start+a.Modules.IconModule_CooldownSweep.duration;local ad=ac-aa;local ae=ac-ab;local af=GetTime()return af>ad and af<ae end;function IROVar.DetermineActiveCovenantAndSoulbindAndConduits()local ag=C_Covenants.GetActiveCovenantID()if not ag or ag==0 then return nil end;local ah=C_Covenants.GetCovenantData(ag)if not ah then return nil end;local ai=ah.name;local aj=C_Soulbinds.GetActiveSoulbindID()if not aj or aj==0 then return nil end;local ak=C_Soulbinds.GetSoulbindData(aj)if not ak then return nil end;local al=ak["ID"]local am=ak["name"]local an=ak["description"]local ao=ak["tree"]local ap=ao["nodes"]local aq={}aq.covenantName=ai;aq.soulbindName=am;aq.conduits={}for _,ar in pairs(ap)do local as=ar["ID"]local at=ar.row;local au=ar.column;local av=ar.spellID;local aw=ar.conduitID;local ax=ar.conduitRank;local ay=ar.state;local az=ar.conduitType;if ay==3 then local aA;if av~=0 then aA=GetSpellInfo(av)elseif aw~=0 then local aB=C_Soulbinds.GetConduitSpellID(aw,ax)av=aB;aA=GetSpellInfo(aB)else av=nil;aA=nil end;if av then aq.conduits[#aq.conduits+1]={spellID=av,spellName=aA}aq[av]=true;aq[aA]=true end end end;return aq end;IROVar.justCheckActiveConduits=0;IROVar.fconduitOnEvent=function()local aC=GetTime()if aC<=IROVar.justCheckActiveConduits then return end;IROVar.justCheckActiveConduits=aC+0.4;C_Timer.After(0.5,function()IROVar.activeConduits=IROVar.DetermineActiveCovenantAndSoulbindAndConduits()if not IROVar.activeConduits then IROVar.activeConduits={}end end)end;IROVar.fconduit=CreateFrame("Frame")IROVar.fconduit:RegisterEvent("COVENANT_CALLINGS_UPDATED")IROVar.fconduit:RegisterEvent("COVENANT_CHOSEN")IROVar.fconduit:RegisterEvent("SOULBIND_ACTIVATED")IROVar.fconduit:RegisterEvent("SOULBIND_PATH_CHANGED")IROVar.fconduit:RegisterEvent("SOULBIND_NODE_UPDATED")IROVar.fconduit:RegisterEvent("GARRISON_UPDATE")IROVar.fconduit:SetScript("OnEvent",IROVar.fconduitOnEvent)C_Timer.After(1,IROVar.fconduitOnEvent)IROVar.incombatCallBackRun={}IROVar.outcombatCallBackRun={}function IROVar.RegisterIncombatCallBackRun(g,aD)IROVar.incombatCallBackRun[g]=aD end;function IROVar.RegisterOutcombatCallBackRun(g,aD)IROVar.outcombatCallBackRun[g]=aD end;function IROVar.UnRegisterOutcombatCallBackRun(g)IROVar.outcombatCallBackRun[g]=nil end;function IROVar.UnRegisterIncombatCallBackRun(g)IROVar.incombatCallBackRun[g]=nil end;IROVar.incombat=UnitAffectingCombat("player")IROVar.incombatFrame=CreateFrame("Frame")IROVar.incombatFrame:RegisterEvent("PLAYER_REGEN_ENABLED")IROVar.incombatFrame:RegisterEvent("PLAYER_REGEN_DISABLED")IROVar.incombatFrame:SetScript("OnEvent",function(self,j)IROVar.incombat=j=="PLAYER_REGEN_DISABLED"if j=="PLAYER_REGEN_DISABLED"then for b,c in pairs(IROVar.incombatCallBackRun)do if c then c()end end else for b,c in pairs(IROVar.outcombatCallBackRun)do if c then c()end end end end)IROVar.COMBAT_LOG_EVENT_UNFILTERED_CALLBACK={}function IROVar.Register_COMBAT_LOG_EVENT_UNFILTERED_CALLBACK(g,aD)IROVar.COMBAT_LOG_EVENT_UNFILTERED_CALLBACK[g]=aD end;function IROVar.UnRegister_COMBAT_LOG_EVENT_UNFILTERED_CALLBACK(g)IROVar.COMBAT_LOG_EVENT_UNFILTERED_CALLBACK[g]=nil end;function IROVar.COMBAT_LOG_EVENT_UNFILTERED_scrip(...)for b,c in pairs(IROVar.COMBAT_LOG_EVENT_UNFILTERED_CALLBACK)do if c then c(...)end end end;IROVar.COMBAT_LOG_EVENT_UNFILTERED_frame=CreateFrame("Frame")IROVar.COMBAT_LOG_EVENT_UNFILTERED_frame:RegisterEvent("COMBAT_LOG_EVENT_UNFILTERED")IROVar.COMBAT_LOG_EVENT_UNFILTERED_frame:SetScript("OnEvent",function(self,j,...)IROVar.COMBAT_LOG_EVENT_UNFILTERED_scrip(CombatLogGetCurrentEventInfo())end)IROVar.SPELL_UPDATE_COOLDOWN_CALLBACK={}function IROVar.SPELL_UPDATE_COOLDOWN_scrip()local aE,aF=GetSpellCooldown(TMW.GCDSpell)local aG=0;if aE then aG=aE+aF end;for b,c in pairs(IROVar.SPELL_UPDATE_COOLDOWN_CALLBACK)do if c then c(aG)end end end;IROVar.SPELL_UPDATE_COOLDOWN_count=0;function IROVar.Register_SPELL_UPDATE_COOLDOWN_scrip_CALLBACK(g,aD)IROVar.SPELL_UPDATE_COOLDOWN_CALLBACK[g]=aD end;function IROVar.UnRegister_SPELL_UPDATE_COOLDOWN_scrip_CALLBACK(g)IROVar.SPELL_UPDATE_COOLDOWN_CALLBACK[g]=nil end;IROVar.SPELL_UPDATE_COOLDOWN_frame=CreateFrame("Frame")IROVar.SPELL_UPDATE_COOLDOWN_frame:RegisterEvent("SPELL_UPDATE_COOLDOWN")IROVar.SPELL_UPDATE_COOLDOWN_frame:RegisterEvent("SPELL_UPDATE_USABLE")IROVar.SPELL_UPDATE_COOLDOWN_frame:SetScript("OnEvent",function(self,j,...)IROVar.SPELL_UPDATE_COOLDOWN_count=IROVar.SPELL_UPDATE_COOLDOWN_count+1;IROVar.SPELL_UPDATE_COOLDOWN_scrip()end)IROVar.TickCount005=0;IROVar.TickCount005_Handle=C_Timer.NewTicker(0.05,function()IROVar.TickCount005=IROVar.TickCount005+1 end)IROVar.CastBar={}IROVar.CastBar.Casting=nil;IROVar.CastBar.Channeling=nil;IROVar.CastBar.Calculated={}IROVar.CastBar.Spell=nil;IROVar.CastBar.SpellId=nil;IROVar.CastBar.CantKick=false;function IROVar.CastBar.CheckCasting()local aH={UnitCastingInfo("target")}if aH[1]then IROVar.CastBar.Casting=aH else IROVar.CastBar.Casting=nil end end;function IROVar.CastBar.CheckChanneling()local aH={UnitChannelInfo("target")}if aH[1]then IROVar.CastBar.Channeling=aH else IROVar.CastBar.Channeling=nil end end;function IROVar.CastBar.ResetKick()IROVar.CastBar.CantKick=false;IROVar.CastBar.Spell=nil;IROVar.CastBar.SpellId=nil;IROVar.CastBar.Calculated={}end;function IROVar.CastBar.CheckSpellInfo()local F=false;local aI=nil;local aJ=nil;if IROVar.CastBar.Casting then F=IROVar.CastBar.Casting[8]aI=IROVar.CastBar.Casting[1]aJ=IROVar.CastBar.Casting[9]elseif IROVar.CastBar.Channeling then F=IROVar.CastBar.Channeling[7]aI=IROVar.CastBar.Channeling[1]aJ=IROVar.CastBar.Channeling[8]end;IROVar.CastBar.CantKick=F;IROVar.CastBar.Spell=aI;IROVar.CastBar.SpellId=aJ end;function IROVar.CastBar.CalculateInterruptTimer(aK)local aL=0.2;aK=aK or 0.6;local aM=0;local aN=0;if IROVar.CastBar.Casting then local aO=IROVar.CastBar.Casting[4]/1000;local aP=IROVar.CastBar.Casting[5]/1000;local aQ=aP-aO;local aR=aQ*aK;aM=aR+aO;aN=aP-aL elseif IROVar.CastBar.Channeling then local aO=IROVar.CastBar.Channeling[4]/1000;local aP=IROVar.CastBar.Channeling[5]/1000;local aQ=aP-aO;if aQ>=1 then aM=aO+0.8;aN=aP-aL end end;IROVar.CastBar.Calculated[aK]={aM,aN}end;IROVar.TargetChangeCount=0;IROVar.TargetName=UnitName("target")IROVar.TargetGUID=UnitGUID("target")IROVar.TargetLV=UnitLevel("target")function IROVar.CastBar.CheckAll()IROVar.CastBar.CheckCasting()IROVar.CastBar.CheckChanneling()IROVar.CastBar.ResetKick()IROVar.CastBar.CheckSpellInfo()end;IROVar.CastBar.CastFrame=CreateFrame("Frame")IROVar.CastBar.CastFrame:RegisterEvent("UNIT_SPELLCAST_START")IROVar.CastBar.CastFrame:RegisterEvent("UNIT_SPELLCAST_CHANNEL_START")IROVar.CastBar.CastFrame:RegisterEvent("PLAYER_TARGET_CHANGED")IROVar.CastBar.CastFrame:SetScript("OnEvent",function(self,j,aS,...)if j=="UNIT_SPELLCAST_START"and aS=="target"then IROVar.CastBar.Channeling=nil;IROVar.CastBar.CheckCasting()IROVar.CastBar.ResetKick()IROVar.CastBar.CheckSpellInfo()elseif j=="UNIT_SPELLCAST_CHANNEL_START"and aS=="target"then IROVar.CastBar.Casting=nil;IROVar.CastBar.CheckChanneling()IROVar.CastBar.ResetKick()IROVar.CastBar.CheckSpellInfo()elseif j=="PLAYER_TARGET_CHANGED"then IROVar.PLAYER_TARGET_CHANGED_Time=GetTime()IROVar.TargetChangeCount=IROVar.TargetChangeCount+1;IROVar.TargetName=UnitName("target")IROVar.TargetGUID=UnitGUID("target")IROVar.TargetLV=UnitLevel("target")IROVar.CastBar.CheckAll()end end)C_Timer.NewTicker(0.3,IROVar.CastBar.CheckAll)IROVar.CastBar.CastFrame2=CreateFrame("Frame")IROVar.CastBar.CastFrame2:RegisterEvent("UNIT_SPELLCAST_FAILED_QUIET")IROVar.CastBar.CastFrame2:RegisterEvent("UNIT_SPELLCAST_CHANNEL_STOP")IROVar.CastBar.CastFrame2:RegisterEvent("UNIT_SPELLCAST_STOP")IROVar.CastBar.CastFrame2:SetScript("OnEvent",function(self,j,aS,...)if aS=="target"then IROVar.CastBar.Casting=nil;IROVar.CastBar.Channeling=nil;IROVar.CastBar.ResetKick()end end)function IROVar.TargetCastBar(aT,aU,aV)if aV and aV~=IROVar.CastBar.SpellId and aV~=IROVar.CastBar.Spell then return false end;aT=aT or 0.6;if not IROVar.CastBar.Calculated[aT]then IROVar.CastBar.CalculateInterruptTimer(aT)end;local aW=IROVar.CastBar.Calculated[aT][1]local aX=IROVar.CastBar.Calculated[aT][2]if not aU and IROVar.CastBar.CantKick then return false end;local aY=GetTime()return aY>=aW and aY<=aX end;function IROVar.CompareTable(aZ,a_)local function b0(b1,b2)if not b1 or not b2 then return false end;local b3=true;for b,c in pairs(b1)do if type(c)=="table"then b3=IROVar.CompareTable(c,b2[b])if not b3 then break end elseif b3 and c~=b2[b]then b3=false;break end end;return b3 end;local b4=b0(aZ,a_)if b4 then b4=b0(a_,aZ)end;return b4 end;IROInterruptTier.CDEnd=0;IROVar.Register_SPELL_UPDATE_COOLDOWN_scrip_CALLBACK("IsMyInterruptSpellReady",function(b5)local aE,aF=GetSpellCooldown(IROVar.InterruptSpell)if aE then IROInterruptTier.CDEnd=aE+aF else IROInterruptTier.CDEnd=0 end end)function IsMyInterruptSpellReady()if not IROVar.InterruptSpell then return false end;return IROInterruptTier.CDEnd<=GetTime()end;local b6={["MAGE"]=true,["SHAMAN"]=true,["DRUID"]=true}IROVar.decurseInGroup=0;function IROVar.DecurseCheck()local function b7(b8)local _,b9=UnitClass(b8)return b6[b9]end;local ba=0;if IsInRaid()then for f=1,40 do local S="raid"..f;if UnitExists(S)and b7(S)then ba=ba+1 end end elseif IsInGroup()then for f=1,4 do local S="party"..f;if UnitExists(S)and b7(S)then ba=ba+1 end end;if b7("player")then ba=ba+1 end else if b7("player")then ba=ba+1 end end;IROVar.decurseInGroup=ba end;IROVar.IsDecurseF=CreateFrame("Frame")IROVar.IsDecurseF:RegisterEvent("GROUP_ROSTER_UPDATE")IROVar.IsDecurseF:SetScript("OnEvent",function()IROVar.DecurseCheck()end)C_Timer.NewTicker(6,IROVar.DecurseCheck,10)function IROVar.DecurseInGroup()return IROVar.decurseInGroup end;function IROVar.UnitCount(S)return IROVar.AutoTarget and IROVar.AutoTarget.UnitCount[S]or 0 end;IROVar.KickPressed=false;function IROVar.KickPress()IROVar.KickPressed=true;C_Timer.After(0.4,function()IROVar.KickPressed=false end)end